---
description: プロジェクト全体の一般的なルールとガイドライン
globs: ["**/*"]
alwaysApply: true
---

# プロジェクト全体のルール

## プロジェクト概要

このプロジェクトは、Discordに投稿された料理レシピURLを自動収集・分類し、Webサイトで閲覧できるシステムです。

## アーキテクチャ

- **フロントエンド**: Next.js 15 (App Router) + TypeScript + Tailwind CSS
- **ホスティング**: Cloudflare Pages
- **バックエンド**: Cloudflare Workers (TypeScript)
- **データベース**: Cloudflare D1 (SQLite)
- **KVストア**: Cloudflare KV（実行履歴管理）
- **AI分類**: OpenAI GPT 5.2
- **Discord連携**: REST API + Cron Triggers

## ディレクトリ構造

- `workers/`: Cloudflare Workers（バックエンドAPI + Cronジョブ）
- `frontend/`: Next.jsアプリケーション（Cloudflare Pages）
- `docs/`: プロジェクトドキュメント

## コーディング規約

- **言語**: 日本語でコメントとドキュメントを記述
- **コミットメッセージ**: 日本語で記述
- **コード**: 英語で記述（変数名、関数名など）

## セキュリティ

- 環境変数は`wrangler secret put`で設定（Workers）
- `.env`ファイルはGitにコミットしない
- APIキーやトークンはシークレットで管理

## パフォーマンス

- Cloudflare Workers CPU制限を意識（無料プラン10ms/リクエスト）
- 不要な再レンダリングを避ける
- 画像の最適化を実施

## Git運用

- 機能追加はブランチを切って開発
- コミットメッセージは明確に記述
- プルリクエストでコードレビューを実施

## 依存関係

- フロントエンド: `npm`で管理（`package.json`）
- Workers: `npm`で管理（`package.json`）
- 依存関係の更新は慎重に行う

## 環境変数

### Workers（wrangler secret put）
- `DISCORD_TOKEN`
- `DISCORD_CHANNEL_ID`
- `OPENAI_API_KEY`

### Pages（Cloudflare Dashboard または wrangler.toml）
- `NEXT_PUBLIC_API_URL`

## デプロイ

- Workers: `wrangler deploy`
- Pages: `npm run pages:deploy`
- Pagesの`nodejs_compat`フラグはDashboardで設定
