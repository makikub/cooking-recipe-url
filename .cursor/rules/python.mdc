---
description: Pythonスクリプトのコーディング規約とベストプラクティス
globs: ["scripts/**/*.py"]
alwaysApply: false
---

# Python コーディング規約

## 基本原則

- **Python 3.11+**: 型ヒントを積極的に使用
- **非同期処理**: `asyncio`を使用して非同期処理を実装
- **エラーハンドリング**: 適切な例外処理を実装
- **ログ**: `logging`モジュールを使用してログ出力

## 命名規則

- **関数・変数**: snake_case（例: `fetch_discord_messages`, `recipe_list`）
- **クラス**: PascalCase（例: `DiscordClient`, `RecipeClassifier`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_RETRIES`, `DEFAULT_TIMEOUT`）
- **プライベート**: アンダースコア1つで開始（例: `_internal_method`）

## 型ヒント

- 関数の引数と戻り値に型ヒントを必ず記述
- `typing`モジュールを活用（`List`, `Dict`, `Optional`, `Union`など）
- 例: `def fetch_messages(channel_id: int) -> List[Dict[str, Any]]:`

## ドキュメント

- モジュールの先頭にdocstringを記述（日本語可）
- 関数にはdocstringを記述（目的、引数、戻り値を説明）
- 複雑なロジックにはコメントを追加

## エラーハンドリング

- 適切な例外をキャッチして処理
- エラーメッセージは明確で分かりやすく
- ログにエラー情報を記録

## ログ設定

- `logging`モジュールを使用
- ログファイルは`logs/`ディレクトリに出力
- ログファイル名はタイムスタンプを含める（例: `collector_20250101_120000.log`）
- ログレベルは適切に設定（INFO, ERROR, DEBUGなど）

## 環境変数

- `python-dotenv`を使用して`.env`ファイルから環境変数を読み込む
- 環境変数の取得は`os.getenv()`を使用
- 必須の環境変数は存在チェックを実施

## 非同期処理

- Discord APIやHTTPリクエストは非同期で処理
- `async`/`await`を適切に使用
- `asyncio.gather()`で並列処理を実装

## データベース操作

- Supabaseクライアントは適切に初期化
- エラーハンドリングを実装
- トランザクション処理を考慮

## 依存関係管理

- `uv`を使用してパッケージ管理
- `pyproject.toml`に依存関係を定義
- バージョン指定は適切に行う

## コード構造

- 各モジュールは単一責任の原則に従う
- 再利用可能な関数は適切に分離
- メインスクリプト（`collector.py`）は処理の流れを明確に
